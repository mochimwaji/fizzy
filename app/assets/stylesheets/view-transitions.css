/* ==========================================================================
   View Transitions - Smooth Page Navigation
   ========================================================================== */

/* Enable cross-document view transitions */
@view-transition {
  navigation: auto;
}

/* ==========================================================================
   Default Page Transition (Cross-fade)
   ========================================================================== */

/* Smooth, comfortable default transition - not too fast, not too slow */
::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 200ms;
  animation-timing-function: ease-out;
  /* Prevent any stretching by containing the snapshot */
  width: 100%;
  height: 100%;
  object-fit: contain;
  /* Ensure no transparency during transition */
  background: var(--color-canvas);
}

/* Old page fades out */
::view-transition-old(root) {
  animation-name: fade-out-quick;
}

/* New page fades in */
::view-transition-new(root) {
  animation-name: fade-in-quick;
}

@keyframes fade-out-quick {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes fade-in-quick {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ==========================================================================
   Mobile Slide Transitions
   ========================================================================== */

/* Forward navigation - new page slides in from right */
/* Removed media query to ensure animations run on all devices */
/* @media (any-hover: none) { */
  /* Use simpler, faster transitions on mobile to prevent stretching */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 350ms;
    animation-timing-function: cubic-bezier(0.32, 0.72, 0, 1);
  }
  
  /* Forward: Old page stays, dims slightly. New page slides over from right. */
  html[data-nav-direction="forward"]::view-transition-old(root) {
    animation: mobile-fade-out-dim 350ms cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 1;
  }
  
  html[data-nav-direction="forward"]::view-transition-new(root) {
    animation: mobile-slide-in-right 350ms cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 2;
    box-shadow: -5px 0 25px rgba(0,0,0,0.15);
  }
  
  /* Back: Old page slides out to right. New page stays, undims. */
  html[data-nav-direction="back"]::view-transition-old(root) {
    animation: mobile-slide-out-right 350ms cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 2;
    box-shadow: -5px 0 25px rgba(0,0,0,0.15);
  }
  
  html[data-nav-direction="back"]::view-transition-new(root) {
    animation: mobile-fade-in-dim 350ms cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 1;
  }
  
  /* Restoration visits should be instant */
  html[data-nav-direction="restore"]::view-transition-old(root),
  html[data-nav-direction="restore"]::view-transition-new(root) {
    animation: none;
  }
/* } */

/* Mobile-specific animations - Stacked effect */
@keyframes mobile-fade-out-dim {
  from { opacity: 1; transform: scale(1); filter: brightness(1); }
  to { opacity: 1; transform: scale(0.95); filter: brightness(0.9); }
}

@keyframes mobile-slide-in-right {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

@keyframes mobile-slide-out-right {
  from { transform: translateX(0); }
  to { transform: translateX(100%); }
}

@keyframes mobile-fade-in-dim {
  from { opacity: 1; transform: scale(0.95); filter: brightness(0.9); }
  to { opacity: 1; transform: scale(1); filter: brightness(1); }
}

/* ==========================================================================
   Named Element Transitions (Persistent UI)
   
   Note: We intentionally don't use view-transition-name on #header and 
   #footer_frames because:
   1. It creates stacking contexts that interfere with fixed position modals
   2. It can cause stretching/morphing artifacts during navigation
   3. The simple root-level fade/slide works better for consistent transitions
   ========================================================================== */

/* Main content area - only transition the content, not the whole page structure */
/* Disabled: This causes stacking context issues with modals
#main {
  view-transition-name: main-content;
}
*/

::view-transition-group(main-content) {
  animation-duration: 200ms;
  animation-timing-function: ease-out;
}

/* Header - no view-transition-name to avoid stacking context and stretching issues */
#header {
  position: relative;
  z-index: 100;
}

/* When calendar modal is open, push header and footer behind it */
body:has(.calendar-modal--open) #header,
body:has(.calendar-modal--open) #footer_frames {
  z-index: 1;
}

/* ==========================================================================
   Card Transitions
   ========================================================================== */

/* Cards can animate between list and detail views */
.card[data-card-id] {
  view-transition-name: var(--card-transition-name);
}

/* Card expand animation */
::view-transition-group(card) {
  animation-duration: 250ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* ==========================================================================
   Mobile-Specific Optimizations
   ========================================================================== */

@media (any-hover: none) {
  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    ::view-transition-old(root),
    ::view-transition-new(root),
    ::view-transition-group(*) {
      animation-duration: 0.01ms !important;
    }
  }
  
  /* Prevent content shift during transitions */
  ::view-transition-image-pair(root) {
    isolation: auto;
  }
  
  /* Ensure smooth rendering - constrain to viewport */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    /* Constrain to viewport exactly to prevent stretching */
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    object-fit: cover;
    object-position: top center;
  }
  
  /* Ensure the transition group fills the viewport correctly */
  ::view-transition-group(root) {
    overflow: hidden;
  }
}

/* ==========================================================================
   Loading State Transitions
   ========================================================================== */

/* Prevent white flash during page transitions */
html {
  background: var(--color-canvas, #fff);
}

@media (prefers-color-scheme: dark) {
  html {
    background: var(--color-canvas, #0d181d);
  }
}

/* Turbo frames fade in when loaded */
/* Removed opacity transition to prevent flickering */
/* turbo-frame[busy] { opacity: 0.6; transition: opacity 150ms ease; } */
/* turbo-frame:not([busy]) { opacity: 1; transition: opacity 150ms ease; } */

/* Only animate frame content on initial load, not on navigation - desktop only */
@media (any-hover: hover) {
  turbo-frame[src]:not([complete]) > * {
    animation: content-appear 200ms ease-out;
  }
}

@keyframes content-appear {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Disable animation for already-loaded content */
turbo-frame[complete] > * {
  animation: none;
}

/* Disable frame animations on mobile to prevent flashing */
@media (any-hover: none) {
  turbo-frame > * {
    animation: none;
  }
}

/* ==========================================================================
   Fallback Animations (for browsers without View Transitions)
   ========================================================================== */

/* Loading state feedback */
html.is-loading {
  cursor: wait;
}

html.is-loading main {
  opacity: 0.8;
  transition: opacity 0.2s ease;
  filter: grayscale(0.2);
}

/* Fallback navigation animation if View Transitions aren't supported */
@supports not (view-transition-name: none) {
  html.is-navigating main {
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
}
