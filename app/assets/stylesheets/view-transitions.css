/* ==========================================================================
   View Transitions - Smooth Page Navigation
   ========================================================================== */

/* Enable cross-document view transitions */
@view-transition {
  navigation: auto;
}

/* ==========================================================================
   Default Page Transition (Cross-fade)
   ========================================================================== */

/* Faster, smoother default transition */
::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 200ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Old page fades out */
::view-transition-old(root) {
  animation-name: fade-out;
}

/* New page fades in */
::view-transition-new(root) {
  animation-name: fade-in;
}

@keyframes fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ==========================================================================
   Mobile Slide Transitions
   ========================================================================== */

/* Forward navigation - new page slides in from right */
@media (any-hover: none) {
  html[data-nav-direction="forward"]::view-transition-old(root) {
    animation: slide-out-left 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  html[data-nav-direction="forward"]::view-transition-new(root) {
    animation: slide-in-right 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Back navigation - new page slides in from left */
  html[data-nav-direction="back"]::view-transition-old(root) {
    animation: slide-out-right 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  html[data-nav-direction="back"]::view-transition-new(root) {
    animation: slide-in-left 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Restoration visits should be instant */
  html[data-nav-direction="restore"]::view-transition-old(root),
  html[data-nav-direction="restore"]::view-transition-new(root) {
    animation: none;
  }
}

@keyframes slide-out-left {
  from { 
    opacity: 1; 
    transform: translateX(0); 
  }
  to { 
    opacity: 0; 
    transform: translateX(-30%); 
  }
}

@keyframes slide-in-right {
  from { 
    opacity: 0; 
    transform: translateX(30%); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0); 
  }
}

@keyframes slide-out-right {
  from { 
    opacity: 1; 
    transform: translateX(0); 
  }
  to { 
    opacity: 0; 
    transform: translateX(30%); 
  }
}

@keyframes slide-in-left {
  from { 
    opacity: 0; 
    transform: translateX(-30%); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0); 
  }
}

/* ==========================================================================
   Named Element Transitions (Persistent UI)
   ========================================================================== */

/* Main content area */
#main {
  view-transition-name: main-content;
}

::view-transition-group(main-content) {
  animation-duration: 200ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Header stays in place */
#header {
  view-transition-name: header;
}

::view-transition-group(header) {
  animation-duration: 150ms;
}

::view-transition-old(header),
::view-transition-new(header) {
  /* Header cross-fades without movement */
  animation: none;
  mix-blend-mode: normal;
}

/* Footer frames are permanent, shouldn't transition */
#footer_frames {
  view-transition-name: footer-frames;
}

::view-transition-old(footer-frames),
::view-transition-new(footer-frames) {
  animation: none;
}

/* ==========================================================================
   Card Transitions
   ========================================================================== */

/* Cards can animate between list and detail views */
.card[data-card-id] {
  view-transition-name: var(--card-transition-name);
}

/* Card expand animation */
::view-transition-group(card) {
  animation-duration: 250ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* ==========================================================================
   Mobile-Specific Optimizations
   ========================================================================== */

@media (any-hover: none) {
  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    ::view-transition-old(root),
    ::view-transition-new(root),
    ::view-transition-group(*) {
      animation-duration: 0.01ms !important;
    }
  }
  
  /* Prevent content shift during transitions */
  ::view-transition-image-pair(root) {
    isolation: auto;
  }
  
  /* Ensure smooth rendering */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    height: 100%;
    overflow: hidden;
  }
}

/* ==========================================================================
   Loading State Transitions
   ========================================================================== */

/* Turbo frames fade in when loaded */
turbo-frame[busy] {
  opacity: 0.6;
  transition: opacity 150ms ease;
}

turbo-frame:not([busy]) {
  opacity: 1;
  transition: opacity 150ms ease;
}

/* Smooth content appearance */
turbo-frame > * {
  animation: content-appear 200ms ease-out;
}

@keyframes content-appear {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Disable animation for already-loaded content */
turbo-frame[complete] > * {
  animation: none;
}
