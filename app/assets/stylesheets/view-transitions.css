/* ==========================================================================
   View Transitions - Smooth Page Navigation
   ========================================================================== */

/* Enable cross-document view transitions */
@view-transition {
  navigation: auto;
}

/* ==========================================================================
   Default Page Transition (Cross-fade)
   ========================================================================== */

/* Smooth, comfortable default transition - not too fast, not too slow */
::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: 200ms;
  animation-timing-function: ease-out;
  /* Prevent any stretching by containing the snapshot */
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* Old page fades out */
::view-transition-old(root) {
  animation-name: fade-out-quick;
}

/* New page fades in */
::view-transition-new(root) {
  animation-name: fade-in-quick;
}

@keyframes fade-out-quick {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes fade-in-quick {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ==========================================================================
   Mobile Slide Transitions
   ========================================================================== */

/* Forward navigation - new page slides in from right */
@media (any-hover: none) {
  /* Use simpler, faster transitions on mobile to prevent stretching */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 200ms;
    animation-timing-function: ease-out;
  }
  
  html[data-nav-direction="forward"]::view-transition-old(root) {
    animation: mobile-slide-out-left 200ms ease-out;
  }
  
  html[data-nav-direction="forward"]::view-transition-new(root) {
    animation: mobile-slide-in-right 200ms ease-out;
  }
  
  /* Back navigation - new page slides in from left */
  html[data-nav-direction="back"]::view-transition-old(root) {
    animation: mobile-slide-out-right 200ms ease-out;
  }
  
  html[data-nav-direction="back"]::view-transition-new(root) {
    animation: mobile-slide-in-left 200ms ease-out;
  }
  
  /* Restoration visits should be instant */
  html[data-nav-direction="restore"]::view-transition-old(root),
  html[data-nav-direction="restore"]::view-transition-new(root) {
    animation: none;
  }
}

/* Mobile-specific animations - smaller transform values, faster */
@keyframes mobile-slide-out-left {
  from { 
    opacity: 1; 
    transform: translateX(0); 
  }
  to { 
    opacity: 0; 
    transform: translateX(-15%); 
  }
}

@keyframes mobile-slide-in-right {
  from { 
    opacity: 0; 
    transform: translateX(15%); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0); 
  }
}

@keyframes mobile-slide-out-right {
  from { 
    opacity: 1; 
    transform: translateX(0); 
  }
  to { 
    opacity: 0; 
    transform: translateX(15%); 
  }
}

@keyframes mobile-slide-in-left {
  from { 
    opacity: 0; 
    transform: translateX(-15%); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0); 
  }
}

/* ==========================================================================
   Named Element Transitions (Persistent UI)
   ========================================================================== */

/* Main content area */
#main {
  view-transition-name: main-content;
}

::view-transition-group(main-content) {
  animation-duration: 200ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Header stays in place */
#header {
  view-transition-name: header;
}

::view-transition-group(header) {
  animation-duration: 150ms;
}

::view-transition-old(header),
::view-transition-new(header) {
  /* Header cross-fades without movement */
  animation: none;
  mix-blend-mode: normal;
}

/* Footer frames are permanent, shouldn't transition */
#footer_frames {
  view-transition-name: footer-frames;
}

::view-transition-old(footer-frames),
::view-transition-new(footer-frames) {
  animation: none;
}

/* ==========================================================================
   Card Transitions
   ========================================================================== */

/* Cards can animate between list and detail views */
.card[data-card-id] {
  view-transition-name: var(--card-transition-name);
}

/* Card expand animation */
::view-transition-group(card) {
  animation-duration: 250ms;
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* ==========================================================================
   Mobile-Specific Optimizations
   ========================================================================== */

@media (any-hover: none) {
  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    ::view-transition-old(root),
    ::view-transition-new(root),
    ::view-transition-group(*) {
      animation-duration: 0.01ms !important;
    }
  }
  
  /* Prevent content shift during transitions */
  ::view-transition-image-pair(root) {
    isolation: auto;
  }
  
  /* Ensure smooth rendering - constrain to viewport */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    /* Constrain to viewport exactly to prevent stretching */
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    object-fit: cover;
    object-position: top center;
  }
  
  /* Ensure the transition group fills the viewport correctly */
  ::view-transition-group(root) {
    overflow: hidden;
  }
}

/* ==========================================================================
   Loading State Transitions
   ========================================================================== */

/* Prevent white flash during page transitions */
html {
  background: var(--color-canvas, #fff);
}

@media (prefers-color-scheme: dark) {
  html {
    background: var(--color-canvas, #0d181d);
  }
}

/* Turbo frames fade in when loaded */
turbo-frame[busy] {
  opacity: 0.6;
  transition: opacity 150ms ease;
}

turbo-frame:not([busy]) {
  opacity: 1;
  transition: opacity 150ms ease;
}

/* Smooth content appearance */
turbo-frame > * {
  animation: content-appear 200ms ease-out;
}

@keyframes content-appear {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Disable animation for already-loaded content */
turbo-frame[complete] > * {
  animation: none;
}
